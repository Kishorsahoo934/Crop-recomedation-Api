<!doctype html>
<html>
<head>
  <meta charset="utf-8"><meta name="viewport" content="width=device-width,initial-scale=1">
  <title>FarmSathi — Dashboard</title>
  <link rel="stylesheet" href="styles.css">
</head>
<body>
  <div class="container">
    <div class="header">
      <div class="brand"><div class="logo">FS</div><div><div class="h1">FarmSathi — Console</div><div class="small">Test endpoints & features</div></div></div>
      <div>
        <button class="btn ghost" onclick="location.href='login.html'">Sign in</button>
      </div>
    </div>

    <div class="grid">
      <div class="left">
        <div class="card">
          <h3 class="section-title">Crop Recommendation</h3>
          <div class="label">Enter soil & weather</div>
          <div class="row" style="gap:8px">
            <input id="c_n" class="field" placeholder="Nitrogen" type="number" value="90">
            <input id="c_p" class="field" placeholder="Phosphorus" type="number" value="40">
            <input id="c_k" class="field" placeholder="Potassium" type="number" value="40">
          </div>
          <div class="row" style="gap:8px;margin-top:8px">
            <input id="c_temp" class="field" placeholder="Temperature" value="25">
            <input id="c_hum" class="field" placeholder="Humidity" value="70">
            <input id="c_ph" class="field" placeholder="pH" value="6.5">
          </div>
          <div style="margin-top:10px">
            <button class="btn" onclick="submitCrop()">Get Recommendation</button>
          </div>
          <div id="cropRes" class="result-box">Result will display here</div>
        </div>

        <div class="card" style="margin-top:12px">
          <h3 class="section-title">Fertilizer Recommendation</h3>
          <div class="row" style="gap:8px">
            <input id="f_temp" class="field" placeholder="Temperature" value="25">
            <input id="f_hum" class="field" placeholder="Humidity" value="60">
            <input id="f_moist" class="field" placeholder="Moisture" value="30">
          </div>
          <div class="row" style="gap:8px;margin-top:8px">
            <input id="f_n" class="field" placeholder="Nitrogen" value="80">
            <input id="f_p" class="field" placeholder="Phosphorus" value="45">
            <input id="f_k" class="field" placeholder="Potassium" value="40">
          </div>
          <div style="margin-top:10px">
            <select id="f_soil" class="field">
              <option>Sandy</option><option>Loamy</option><option>Black</option><option>Red</option><option>Clayey</option>
            </select>
            <select id="f_crop" class="field" style="margin-top:8px">
              <option>Maize</option><option>Paddy</option><option>Wheat</option>
            </select>
            <div style="margin-top:8px"><button class="btn" onclick="submitFert()">Suggest Fertilizer</button></div>
          </div>
          <div id="fertRes" class="result-box">Result will display here</div>
        </div>

        <div class="card" style="margin-top:12px">
          <h3 class="section-title">Crop Statistics</h3>
          <input id="stat_name" class="field" placeholder="Enter crop name exactly (e.g., Rice)">
          <div style="margin-top:8px;display:flex;gap:8px">
            <button class="btn" onclick="openCropStats()">Open Stats Page</button>
            <button class="btn ghost" onclick="fetchStats()">Quick Fetch</button>
          </div>
          <div id="statRes" class="result-box">Result will display here</div>
        </div>
      </div>

      <aside>
        <div class="card">
          <h3 class="section-title">Quick Links</h3>
          <div style="display:flex;flex-direction:column;gap:8px;margin-top:8px">
            <button class="btn" onclick="location.href='disease.html'">Plant Disease Detection</button>
            <button class="btn" onclick="location.href='chatbot.html'">Open Chatbot</button>
            <button class="btn ghost" onclick="healthCheck()">Server Health</button>
          </div>
          <div id="statusBox" class="result-box" style="margin-top:10px">Server status</div>
        </div>
      </aside>
    </div>

    <div class="footer">FarmSathi — Developer Console</div>
  </div>

  <script src="common.js"></script>
  <script>
    function elementText(id, html){ document.getElementById(id).innerHTML = html; }

    async function submitCrop(){
      const form = new FormData();
      form.append('nitrogen', document.getElementById('c_n').value);
      form.append('phosphorus', document.getElementById('c_p').value);
      form.append('potassium', document.getElementById('c_k').value);
      form.append('temperature', document.getElementById('c_temp').value);
      form.append('humidity', document.getElementById('c_hum').value);
      form.append('ph', document.getElementById('c_ph').value);
      form.append('rainfall', 100);

      elementText('cropRes', '<div class="small">Requesting...</div>');
      try{
        const r = await fetch(`${BASE_URL}/crop-recommend`, { method:'POST', body: form });
        const data = await r.json();
        if(!r.ok){ showError(document.getElementById('cropRes'), data); return; }
        elementText('cropRes', `<div><strong>Recommended:</strong> <span style="color:var(--accent)">${escapeHtml(data.recommended_crop)}</span></div>`);
      }catch(e){ showError(document.getElementById('cropRes'), e); }
    }

    async function submitFert(){
      const form = new FormData();
      form.append('temp', document.getElementById('f_temp').value);
      form.append('humidity', document.getElementById('f_hum').value);
      form.append('moisture', document.getElementById('f_moist').value);
      form.append('nitrogen', document.getElementById('f_n').value);
      form.append('phosphorous', document.getElementById('f_p').value);
      form.append('potassium', document.getElementById('f_k').value);
      form.append('ph', 6.5);
      form.append('soil_type', document.getElementById('f_soil').value);
      form.append('crop_type', document.getElementById('f_crop').value);

      elementText('fertRes','<div class="small">Requesting...</div>');
      try{
        const r = await fetch(`${BASE_URL}/fertilizer-recommend`, { method:'POST', body: form });
        const data = await r.json();
        if(!r.ok){ showError(document.getElementById('fertRes'), data); return; }
        elementText('fertRes', `<div><strong>Fertilizer:</strong> <span style="color:var(--accent)">${escapeHtml(data.recommended_fertilizer)}</span></div>`);
      }catch(e){ showError(document.getElementById('fertRes'), e); }
    }

    function openCropStats(){ const name = document.getElementById('stat_name').value.trim(); if(!name) return alert('Enter crop name'); location.href = `disease.html?crop=${encodeURIComponent(name)}`; }

    async function fetchStats(){
      const name = document.getElementById('stat_name').value.trim();
      if(!name) return elementText('statRes','Please enter crop name');
      elementText('statRes','<div class="small">Requesting...</div>');
      try{
        const r = await fetch(`${BASE_URL}/crop-stats/${encodeURIComponent(name)}`);
        const data = await r.json();
        if(!r.ok){ showError(document.getElementById('statRes'), data); return; }
        // present in readable format
        const stats = data.statistics;
        const lines = [];
        for(let i=0;i<stats.Parameter.length;i++){
          lines.push(`${stats.Parameter[i]} — min: ${stats.Minimum[i]}, avg: ${Math.round(stats.Average[i])}, max: ${stats.Maximum[i]}`);
        }
        elementText('statRes', `<div><strong>Summary:</strong><div style="margin-top:8px">${escapeHtml(data.summary)}</div><div style="margin-top:8px">${lines.map(l=>`<div class="small">• ${escapeHtml(l)}</div>`).join('')}</div></div>`);
      }catch(e){ showError(document.getElementById('statRes'), e); }
    }

    async function healthCheck(){
      elementText('statusBox','<div class="small">Checking server...</div>');
      try{
        const r = await fetch(`${BASE_URL}/`);
        const j = await r.json();
        if(!r.ok) throw j;
        elementText('statusBox', `<div><strong>Server:</strong> OK — ${escapeHtml(JSON.stringify(j))}</div>`);
      }catch(e){ showError(document.getElementById('statusBox'), e); }
    }
  </script>
</body>
</html>
